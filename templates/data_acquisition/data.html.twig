{# templates/weather/index.html.twig #}
{% macro weatherIcons(frshtt) %}
    {% set icons = [] %}
    {% if frshtt|slice(0, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-thermometer-snow" title="Vorst"></i>']) %}
    {% endif %}
    {% if frshtt|slice(1, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-cloud-rain" title="Regen"></i>']) %}
    {% endif %}
    {% if frshtt|slice(2, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-snow" title="Sneeuw"></i>']) %}
    {% endif %}
    {% if frshtt|slice(3, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-cloud-hail" title="Hagel"></i>']) %}
    {% endif %}
    {% if frshtt|slice(4, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-cloud-lightning" title="Onweer"></i>']) %}
    {% endif %}
    {% if frshtt|slice(5, 1) == '1' %}
        {% set icons = icons|merge(['<i class="bi bi-tornado" title="Tornado"></i>']) %}
    {% endif %}
    {{ icons|join(' ')|raw }}
{% endmacro %}

{% import _self as macros %}

{% extends 'base.html.twig' %}

{% block title %}Weer Data{% endblock %}

{% block header %}
    {% include 'header.html.twig' %}
{% endblock %}

{% block body %}
    <div class="container-fluid">
    <div class="row mt-3 gx-5 justify-content-center">
    <div class="col-md-3">
    <div class="card text-center">
        <div class="card-body">
            <!-- Filter Form -->
            <form method="get" action="{{ path('app_data_acquisition_data') }}">
                <h2>Filter</h2>

                <div class="form-group col-md-6">
                    <label for="STN">Station ID</label>
                    <input type="text" name="STN" placeholder="Station" value="{{ app.request.query.get('STN') }}">
                </div>
                <div class="form-group col-md-6">
                    <label for="startDate">Begin Datum</label>
                    <input type="date" name="startDate" value="{{ app.request.query.get('startDate') }}">
                </div>
                <div class="form-group col-md-6">
                    <label for="endDate">Eind Datum</label>
                    <input type="date" name="endDate" value="{{ app.request.query.get('endDate') }}">
                </div>
                <div class="form-group col-md-6">
                    <label for="startTime">Begin Tijd</label>
                    <input type="text" name="startTime" placeholder="HH:mm:ss"
                           value="{{ app.request.query.get('startTime') }}"
                           pattern="\d{2}:\d{2}:\d{2}" title="Enter start time in HH:mm:ss format">
                </div>
                <div class="form-group col-md-6">
                    <label for="endTime">Eind Tijd</label>
                    <input type="text" name="endTime" placeholder="HH:mm:ss" value="{{ app.request.query.get('endTime') }}"
                           pattern="\d{2}:\d{2}:\d{2}" title="Enter end time in HH:mm:ss format">
                </div>
                <div class="form-group col-md-6">
                    <label for="limit">Aantal rijen</label>
                    <input type="number" name="limit" placeholder="Limit" value="{{ app.request.query.get('limit', 10) }}">
                </div>

                <button type="submit" class="btn btn-primary">Data ophalen</button>
            </form>
            <!-- End of Filter Form -->
        </div>
    </div>
    </div>
        <div class="col-md-8">
            <h1>Weather Data</h1>


            <table class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Station</th>
                    <th>Datum</th>
                    <th>Tijd</th>
                    <th>Temperatuur</th>
                    <th>Dauwpunt</th>
                    <th>Luchtdruk (Station / Zee)</th>
                    <th>Bewolking</th>
                    <th>Zicht</th>
                    <th>Wind</th>
                    <th>Windrichting</th>
                    <th>Neerslag</th>
                    <th>Sneeuw</th>
                    <th>Evenement</th>
                </tr>
                </thead>
                <tbody>
                {% for weather in weatherData %}
                    <tr>
                        <td>{{ weather.id }}</td>
                        <td>{{ weather.station.getName }}</td>
                        <td>{{ weather.DATE|date('Y-m-d') }}</td>
                        <td>{{ weather.TIME|date('H:i:s') }}</td>
                        <td>{{ weather.TEMP }}℃</td>
                        <td>{{ weather.DEWP }}℃</td>
                        <td>{{ weather.STP }}hPa / {{ weather.SLP }}hPa</td>
                        <td>{{ weather.CLDC }}%</td>
                        <td>{{ weather.VISIB }}</td>
                        <td>{{ weather.WDSP }}</td>
                        <td>{{ weather.WNDDIR }}°</td>
                        <td>{{ weather.PRCP != null ? weather.PRCP ~ 'cm' : '' }}</td>
                        <td>{{ weather.SNDP != null ? weather.SNDP ~ 'cm' : '' }}</td>
                        <td>{{ macros.weatherIcons(weather.FRSHTT) }}</td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="12">No weather data available</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <nav>
                <ul class="pagination">
                    {# "Previous" button #}
                    <li class="page-item{% if current_page == 1 %} disabled{% endif %}">
                        <a class="page-link" href="{{ path('app_data_acquisition_data', {'page': current_page - 1}) }}">Vorige</a>
                    </li>

                    {# Calculate start and end page numbers for the 5-page range #}
                    {% set start_page = max(1, current_page - 2) %}
                    {% set end_page = min(total_pages, start_page + 4) %}
                    {% set start_page = max(1, end_page - 4) %}

                    {# Page number buttons #}
                    {% for page in start_page..end_page %}
                        <li class="page-item{% if page == current_page %} active{% endif %}">
                            <a class="page-link"
                               href="{{ path('app_data_acquisition_data', {'page': page}) }}">{{ page }}</a>
                        </li>
                    {% endfor %}

                    {# "Next" button #}
                    <li class="page-item{% if current_page == total_pages %} disabled{% endif %}">
                        <a class="page-link" href="{{ path('app_data_acquisition_data', {'page': current_page + 1}) }}">Volgende</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
{% endblock %}